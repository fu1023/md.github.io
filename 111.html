<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>在线 Markdown 编辑器</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="一个可部署到 GitHub Pages 的在线 Markdown 编辑器：编辑、预览、保存、导出 Gist" />
</head>
<body>
  <header class="topbar">
    <div class="title">在线 Markdown 编辑器</div>
    <div class="controls">
      <button id="newBtn" title="新建">新建</button>
  <button id="webdavSettingsBtn" title="WebDAV 设置">WebDAV 设置</button>
  <button id="saveWebdavBtn" title="保存到坚果云">保存到坚果云</button>
  <button id="loadWebdavBtn" title="从坚果云加载">从坚果云加载</button>
  <button id="listWebdavBtn" title="我的坚果云文件">我的坚果云文件</button>
      <input id="openFileInput" type="file" accept=".md,text/markdown" style="display:none" />
      <button id="openBtn" title="打开本地文件">打开</button>
      <button id="saveBtn" title="下载为 .md 文件">下载(.md)</button>
      <button id="gistBtn" title="保存到 GitHub Gist">保存为 Gist</button>
      <button id="clearBtn" title="清空编辑器">清空</button>
      <button id="togglePreviewBtn" title="切换预览">切换预览</button>
    </div>
  </header>

  <main class="editor-area">
    <section class="pane left">
      <textarea id="editor" placeholder="在这里输入 Markdown…"></textarea>
    </section>
    <section class="pane right" id="preview" aria-live="polite"></section>
  </main>

  <footer class="footer">
    <div class="status"><span id="status">已就绪</span></div>
    <div class="actions">自动保存：<span id="autosave">开启（localStorage）</span></div>
  </footer>

  <!-- Hidden modal for Gist token/description -->
  <div id="gistModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h3>保存为 GitHub Gist</h3>
      <label>Personal Access Token (选择性，若留空则无法创建 private gist):</label>
      <input id="gistToken" placeholder="输入或粘贴 GitHub PAT（gist 权限）" />
      <label>描述（可选）</label>
      <input id="gistDesc" placeholder="Gist 描述（选填）" />
      <label><input type="checkbox" id="gistPublic" checked /> 公共 Gist</label>
      <div class="modal-actions">
        <button id="createGistBtn">创建 Gist</button>
        <button id="cancelGistBtn">取消</button>
      </div>
      <p class="modal-note">说明：使用 PAT 时请确保权限安全。若不愿意提供 token，可先选择下载本地文件再手动上传。</p>
    </div>
  </div>

    <!-- WebDAV (坚果云) 设置 Modal -->
    <div id="webdavModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <h3>坚果云 / WebDAV 设置</h3>
        <label>WebDAV 服务器 URL</label>
        <input id="webdavUrl" placeholder="例如: https://dav.jianguoyun.com/dav/" />
        <label>用户名（通常为邮箱）</label>
        <input id="webdavUser" placeholder="你的坚果云用户名/邮箱" />
        <label>密码 / WebDAV 密码（不会默认保存）</label>
        <input id="webdavPass" type="password" placeholder="WebDAV 密码" />
        <label>保存目录（远程路径，相对于 WebDAV 根，示例：/Documents/notes）</label>
        <input id="webdavFolder" placeholder="/" />
        <label><input type="checkbox" id="webdavRemember" /> 记住服务器地址与用户名（不会保存密码，除非勾选）</label>
        <div class="modal-actions">
          <button id="webdavSaveSettingsBtn">保存设置</button>
          <button id="webdavCancelBtn">取消</button>
        </div>
        <p class="modal-note">说明：若希望保存密码可勾选后保存，但风险自负。请在使用后登出或关闭浏览器以清除会话密码。</p>
      </div>
    </div>

  <!-- Libraries -->
  <!-- WebDAV integration (坚果云) uses browser fetch; configuration stored in modal -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
